/*var config = {
    type: Phaser.AUTO,
    width: 800,
    height: 600,
    physics: {
        default: 'arcade',
        arcade: {
            gravity: { y: 200 },
            gravity: {x: 200}
        }
    },
    scene: {
        preload: preload,
        create: create,
        update: update
    }
};

var game = new Phaser.Game(config);*/

class Game extends Phaser.Scene {
    constructor() {
        super("Game");
        this.passos;
        this.ovni;
        this.premios;

        this.distancia;
        this.txtDistancia;
    }

    preload() {
        this.load.setBaseURL('https://labs.phaser.io');
        this.load.image('sky', 'assets/skies/space.jpg');
        this.load.image('asteroids', 'assets/games/asteroids/asteroid1.png');
        this.load.image('asteroids2', 'assets/games/asteroids/asteroid2.png');
        this.load.image('asteroids3', 'assets/games/asteroids/asteroid1.png');
        this.load.image('red', 'assets/particles/yellow.png');
        this.load.spritesheet('ovni', 'assets/sprites/player.png', {frameWidth: 32, frameHeight: 48});

        this.load.audio('menu', 'assets/audio/SoundEffects/menu_select.mp3');
        this.load.audio('win', 'assets/audio/SoundEffects/key.wav');
    }

    create() {
        this.add.image(700, 500, 'sky');
        
        var music = this.sound.add('menu');
        music.play();

        

        var particles = this.add.particles('red');
        var particles2 = this.add.particles('red');
        var particles3 = this.add.particles('red');


        var emitter = particles.createEmitter({
            speed: 100,
            scale: { start: 1, end: 0 },
            blendMode: 'ADD'
        });

        var emitter2 = particles2.createEmitter({
            speed: 100,
            scale: { start: 1, end: 0 },
            blendMode: 'ADD'
        });

        var emitter3 = particles3.createEmitter({
            speed: 100,
            scale: { start: 1, end: 0 },
            blendMode: 'ADD'
        });


        this.premios = this.physics.add.group({
            key: 'asteroids',
            key: 'asteroids2',
            key: 'asteroids3',
        });


        var asteroids = this.physics.add.image(400, 100, 'asteroids');
        var asteroids2 = this.physics.add.image(500, 200, 'asteroids2');
        var asteroids3 = this.physics.add.image(500, 200, 'asteroids');


        asteroids.setVelocity(800, 1000);
        asteroids.setBounce(1, 1);
        asteroids.setCollideWorldBounds(true);

        asteroids2.setVelocity(800, 1000);
        asteroids2.setBounce(1, 1);
        asteroids2.setCollideWorldBounds(true);

        
        asteroids3.setVelocity(800, 1000);
        asteroids3.setBounce(1, 1);
        asteroids3.setCollideWorldBounds(true);

        emitter.startFollow(asteroids);
        emitter2.startFollow(asteroids2);
        emitter3.startFollow(asteroids3);


        this.ovni = this.physics.add.image(320, 470, 'ovni', 4);
        this.ovni.setScale(2.5, 2.5);

        this.cursorsKeys = this.input.keyboard.createCursorKeys();
    
        this.ovni.setVelocityX(20);
        this.ovni.setVelocity(20, 10);
        this.ovni.setCollideWorldBounds(true);

        /*this.ovni = this.input.keyboard.on("keydown_LEFT", () => this.teclado('ESQUERDA'));
        this.ovni = this.input.keyboard.on("keydown_RIGHT", () => this.teclado('DIREITA'));
        this.ovni = this.input.keyboard.on("keydown_DOWN", () => this.teclado('BAIXO'));
        this.ovni = this.input.keyboard.on("keydown_UP", () => this.teclado('CIMA'));*/

        var c1;
        var c2;
        var c3;

        c1 = this.physics.add.collider(this.ovni, asteroids);
        c2 = this.physics.add.collider(this.ovni, asteroids2);
        c3 = this.physics.add.collider(this.ovni, asteroids3);
        //this.physics.add.collider(this.ovni, this.premios, this.pegou, null, this);
        //this.physics.add.collider(this.ovni, this.premios, this.pegou, null, this);

        this.passos = 70;

        this.add.text(10, 50, "Distancia:", {fontSize: '16px', fill: 'white'});

        this.distancia = 0;
        this.txtDistancia = this.add.text(110, 50, this.distancia, {fontSize: '16px', fill: 'white'});


    }
    /*teclado(tecla){
        switch(tecla){
            case 'ESQUERDA':
                this.ovni = this.passos * -1;
                break;
            case 'DIREITA':
                this.ovni = this.passos * +1;
                break;
            case 'BAIXO':
                this.ovni = 0;
                break;
            case 'CIMA':
                this.ovni = this.passos * +1;
                break;
            default:
                break;        
        } 
    }*/

    update() {
        if((this.cursorsKeys.left.isDown) && (this.ovni.x > 200)){
            this.ovni.setVelocityX(-200);
        }
        else if((this.cursorsKeys.right.isDown) && (this.ovni.x < 650)){
            this.ovni.setVelocityX(200);
        }
        else if((this.cursorsKeys.up.isDown) && (this.ovni.y > 200)){
            this.ovni.setVelocityY(-200);
        }
        else if(this.cursorsKeys.down.isDown){
            this.ovni.setVelocityY(200);
        }
        else if(this.cursorsKeys.space.isDown){
            this.scene.restart();
        }
        
        this.distancia++;
        this.txtDistancia.text = this.distancia;

        if(this.distancia == 501){
            this.add.text(150, 250, "PARABÃ‰NS, VOCE VENCEU", {fontSize: '32px', fill: 'green'});
            this.ovni.disableBody(true, true);
            this.txtDistancia.destroy();
            var music2 = this.sound.add('win');
            music2.play();
            //this.cursorsKeys.space.isDown(this.scene.restart);
        }
        /*else if(this.c1 = true){
            this.add.text(150, 250, "Voce perdeu, tente novamente", {fontSize: '32px', fill: 'red'});
            this.ovni.disableBody(true, true);
            this.txtDistancia.destroy();
            this.scene.restart();
        }
        
        else if(this.c2 = true){
            this.add.text(150, 250, "Voce perdeu, tente novamente", {fontSize: '32px', fill: 'red'});
            this.ovni.disableBody(true, true);
            this.txtDistancia.destroy();
            this.scene.restart();
        }
        
        else if(this.c3 = true){
            this.add.text(150, 250, "Voce perdeu, tente novamente", {fontSize: '32px', fill: 'red'});
            this.ovni.disableBody(true, true);
            this.txtDistancia.destroy();
            this.scene.restart();
        }*/

    }

    pegou(ovni, item){
       switch (item.texture.key){
            case "asteroids":
                this.scene.start("MenuFinal");
                break;
            case "asteroids2":
                this.scene.start("MenuFinal");
            break;
            case "asteroids3":
                this.scene.start("MenuFinal");
                break; 
                
            default:
                break;
        }   
    }
}
